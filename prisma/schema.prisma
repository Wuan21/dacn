generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model appointment {
  id              Int                  @id @default(autoincrement())
  patientId       Int
  doctorProfileId Int
  appointmentTime DateTime
  status          appointments_status? @default(pending)
  createdAt       DateTime?            @default(now())
  patient         user                 @relation(fields: [patientId], references: [id], onDelete: Cascade)
  doctorProfile   doctorprofile        @relation(fields: [doctorProfileId], references: [id], onDelete: Cascade)
  medicalrecord   medicalrecord?

  @@index([doctorProfileId])
  @@index([patientId])
  @@map("appointments")
}

model doctorprofile {
  id              Int               @id @default(autoincrement())
  userId          Int               @unique
  specialtyId     Int
  bio             String?           @db.Text
  degree          String?
  experience      String?
  fees            Decimal?          @db.Decimal(10, 2)
  address1        String?
  address2        String?
  profileImage    String?           @db.LongText
  // Lịch làm việc cố định hàng tuần (JSON)
  // Format: [{"dayOfWeek": 1, "shifts": [{"shift": "morning", "startTime": "07:30", "endTime": "11:30"}]}]
  workSchedule    String?           @db.Text
  slotDuration    Int               @default(30) // Thời lượng 1 slot khám (phút)
  // Lịch làm việc theo tuần (JSON) - lưu theo từng tuần cụ thể
  // Format: {"2025-12-28": [{"dayOfWeek": 1, "shift": "morning", "startTime": "08:00", "endTime": "12:00", "slotDuration": 30, "isAvailable": true}]}
  schedules       String?           @db.LongText
  appointments    appointment[]
  user            user              @relation(fields: [userId], references: [id], onDelete: Cascade)
  specialty       specialty         @relation(fields: [specialtyId], references: [id], onDelete: Cascade)

  @@index([specialtyId])
  @@map("doctor_profiles")
}

model medicalrecord {
  id            Int            @id @default(autoincrement())
  appointmentId Int            @unique
  diagnosis     String         @db.Text
  symptoms      String?        @db.Text
  notes         String?        @db.Text
  createdAt     DateTime?      @default(now())
  appointment   appointment    @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  prescription  prescription[]

  @@map("medical_records")
}

model prescription {
  id              Int           @id @default(autoincrement())
  medicalRecordId Int
  medication      String
  dosage          String?
  duration        String?
  instructions    String?       @db.Text
  createdAt       DateTime?     @default(now())
  medicalrecord   medicalrecord @relation(fields: [medicalRecordId], references: [id], onDelete: Cascade)

  @@index([medicalRecordId])
  @@map("prescriptions")
}

model specialty {
  id            Int             @id @default(autoincrement())
  name          String          @unique
  doctorprofile doctorprofile[]

  @@map("specialties")
}

model servicepackage {
  id          Int                    @id @default(autoincrement())
  name        String
  description String?                @db.Text
  price       Decimal                @db.Decimal(10, 2)
  duration    Int                    // Thời gian ước tính (phút)
  icon        String?                @db.VarChar(50)
  isActive    Boolean?               @default(true)
  isPopular   Boolean?               @default(false) // Gói phổ biến
  createdAt   DateTime?              @default(now())
  items       servicepackageitem[]

  @@map("service_packages")
}

model servicepackageitem {
  id               Int            @id @default(autoincrement())
  packageId        Int
  name             String         // Tên phần khám (VD: Xét nghiệm máu, X-quang phổi,...)
  description      String?        @db.Text
  category         String?        // Loại: 'Xét nghiệm', 'Chẩn đoán hình ảnh', 'Khám lâm sàng'
  displayOrder     Int            @default(0)
  package          servicepackage @relation(fields: [packageId], references: [id], onDelete: Cascade)

  @@index([packageId])
  @@map("service_package_items")
}

model user {
  id                   Int            @id @default(autoincrement())
  email                String         @unique
  name                 String?
  password             String
  role                 users_role     @default(patient)
  isActive             Boolean?       @default(false)
  activationCode       String?
  activationCodeExpiry DateTime?
  phone                String?
  address              String?
  dateOfBirth          DateTime?
  gender               users_gender?
  profileImage         String?        @db.LongText
  createdAt            DateTime?      @default(now())
  appointments         appointment[]
  doctorprofile        doctorprofile?

  @@map("users")
}

enum appointments_status {
  pending
  confirmed
  completed
  cancelled
}

enum users_role {
  admin
  doctor
  patient
}

enum users_gender {
  male
  female
  other
}
