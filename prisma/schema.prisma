generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model appointment {
  id              String               @id @default(auto()) @map("_id") @db.ObjectId
  patientId       String               @db.ObjectId
  doctorProfileId String               @db.ObjectId
  appointmentTime DateTime
  status          appointments_status? @default(pending)
  createdAt       DateTime             @default(now())
  patient         user                 @relation(fields: [patientId], references: [id], onDelete: Cascade)
  doctorProfile   doctorprofile        @relation(fields: [doctorProfileId], references: [id], onDelete: Cascade)
  medicalrecord   medicalrecord?

  @@map("appointments")
}

model doctorprofile {
  id              String            @id @default(auto()) @map("_id") @db.ObjectId
  userId          String            @unique @db.ObjectId
  specialtyId     String            @db.ObjectId
  bio             String?
  degree          String?
  experience      String?
  fees            Float?
  address1        String?
  address2        String?
  profileImage    String?
  appointments    appointment[]
  doctorschedules doctorschedule[]
  user            user              @relation(fields: [userId], references: [id], onDelete: Cascade)
  specialty       specialty         @relation(fields: [specialtyId], references: [id], onDelete: Cascade)

  @@map("doctor_profiles")
}

model medicalrecord {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  appointmentId String         @unique @db.ObjectId
  diagnosis     String
  symptoms      String?
  notes         String?
  createdAt     DateTime       @default(now())
  appointment   appointment    @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  prescription  prescription[]

  @@map("medical_records")
}

model prescription {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  medicalRecordId String        @db.ObjectId
  medication      String
  dosage          String?
  duration        String?
  instructions    String?
  createdAt       DateTime      @default(now())
  medicalrecord   medicalrecord @relation(fields: [medicalRecordId], references: [id], onDelete: Cascade)

  @@map("prescriptions")
}

model specialty {
  id            String          @id @default(auto()) @map("_id") @db.ObjectId
  name          String          @unique
  doctorprofile doctorprofile[]

  @@map("specialties")
}

model doctorschedule {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  doctorProfileId String        @db.ObjectId
  dayOfWeek       Int           // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
  shift           String        // 'morning', 'afternoon', 'evening'
  startTime       String        // '08:00'
  endTime         String        // '12:00'
  isAvailable     Boolean       @default(true)
  weekStartDate   DateTime?     // Ngày bắt đầu tuần (để quản lý theo tuần cụ thể)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  doctorProfile   doctorprofile @relation(fields: [doctorProfileId], references: [id], onDelete: Cascade)

  @@map("doctor_schedules")
}

model service {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  price       Float
  duration    Int
  category    String?
  icon        String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  @@map("services")
}

model user {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  email         String         @unique
  name          String?
  password      String
  role          users_role     @default(patient)
  isActive      Boolean        @default(true)
  phone         String?
  address       String?
  dateOfBirth   DateTime?
  gender        users_gender?
  profileImage  String?
  createdAt     DateTime       @default(now())
  appointments  appointment[]
  doctorprofile doctorprofile?

  @@map("users")
}

enum appointments_status {
  pending
  confirmed
  completed
  cancelled
}

enum users_role {
  admin
  doctor
  patient
}

enum users_gender {
  male
  female
  other
}
